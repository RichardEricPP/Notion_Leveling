<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CS Student Dungeon - Rediseño</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Three.js Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <!-- Three.js Addons -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/EffectComposer.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/RenderPass.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/shaders/CopyShader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/ShaderPass.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/shaders/LuminosityHighPassShader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/UnrealBloomPass.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <style>
        body {
            font-family: 'Rajdhani', sans-serif;
            background-color: #0f172a;
            color: #e2e8f0;
            overflow-x: hidden;
        }

        /* --- Welcome Screen Styles --- */
        #world {
            position: fixed; top: 0; left: 0; width: 100%; height: 100vh; z-index: 1; transition: opacity 1.5s ease-out;
        }
        #welcome-wrapper {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 10; display: flex; align-items: center; justify-content: center; transition: opacity 0.5s ease-out;
        }
        .welcome-container {
            font-family: 'Inter', sans-serif;
            background-color: rgba(17, 24, 39, 0.7);
            border: 1px solid #0ea5e9;
            box-shadow: 0 0 25px rgba(14, 165, 233, 0.3);
            backdrop-filter: blur(5px); -webkit-backdrop-filter: blur(5px);
        }
        .welcome-title { color: #67e8f9; text-shadow: 0 0 10px rgba(103, 232, 249, 0.5); }
        .sync-button { background-color: #ffffff; color: #111827; }
        .sync-button:hover { background-color: #e5e7eb; }
        .fade-out { opacity: 0 !important; pointer-events: none; }
        .fade-in { opacity: 1 !important; transition: opacity 0.8s ease-in; }

        /* --- Dashboard Styles --- */
        .panel {
            background-color: #1e293b;
            border: 1px solid rgba(56, 189, 248, 0.2);
            border-radius: 0.5rem;
            box-shadow: 0 0 15px rgba(56, 189, 248, 0.1);
            position: relative;
            overflow: hidden;
        }
        .panel-header { background-color: rgba(15, 23, 42, 0.5); border-bottom: 1px solid rgba(56, 189, 248, 0.2); padding: 0.25rem 1rem; font-weight: 600; color: #cbd5e1; }
        .accent-text { color: #38bdf8; }
        .neon-text-blue { color: #38bdf8; text-shadow: 0 0 3px #000, 0 0 7px #000, 0 0 5px #38bdf8, 0 0 8px #38bdf8; }
        .accent-gradient { background: linear-gradient(90deg, #38bdf8 0%, #0ea5e9 100%); }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #1e293b; }
        ::-webkit-scrollbar-thumb { background: #38bdf8; border-radius: 3px; }
        @keyframes level-up-glow { 0% { text-shadow: 0 0 5px #38bdf8, 0 0 10px #38bdf8; } 50% { text-shadow: 0 0 20px #38bdf8, 0 0 30px #38bdf8, 0 0 40px #0ea5e9; } 100% { text-shadow: 0 0 5px #38bdf8, 0 0 10px #38bdf8; } } 
        .level-up-animation { animation: level-up-glow 1.5s ease-in-out; }
        .calendar-day-name { font-size: 0.7rem; color: #94a3b8; }
        .calendar-day { font-size: 0.8rem; color: #e2e8f0; }
        .calendar-day.today { background-color: #38bdf8; color: #0f172a; border-radius: 9999px; font-weight: bold; }
        .project-item { background-color: rgba(15, 23, 42, 0.6); border-radius: 0.5rem; padding: 0.75rem; display: flex; align-items: center; gap: 0.75rem; transition: background-color 0.3s ease; border: 1px solid transparent; }
        .project-item:hover { background-color: rgba(30, 41, 59, 0.8); border-color: rgba(56, 189, 248, 0.2); }
        .project-icon { width: 40px; height: 40px; border-radius: 9999px; display: flex; align-items: center; justify-content: center; background-color: #334155; flex-shrink: 0; }
        .day-selector-tab { padding: 0.5rem; border-radius: 0.375rem; cursor: pointer; transition: background-color 0.3s, color 0.3s; text-align: center; flex-grow: 1; }
        .day-selector-tab.active { background-color: #38bdf8; color: #0f172a; }
        .day-selector-tab:not(.active):hover { background-color: #334155; }
        .achievement-item { background-color: rgba(15, 23, 42, 0.6); border-radius: 0.5rem; padding: 0.75rem; display: flex; align-items: center; gap: 0.75rem; }
        .achievement-icon { width: 32px; height: 32px; flex-shrink: 0; display: flex; align-items: center; justify-content: center; border-radius: 0.25rem; background-color: rgba(56, 189, 248, 0.1); }
        .bar-container { width: 1.5rem; position: relative; display: flex; justify-content: center; align-items: flex-end; }
        .bar { width: 100%; background-color: #475569; border-radius: 4px 4px 0 0; transition: background-color 0.3s ease, filter 0.3s ease; animation: growBar 0.8s ease-out forwards; transform-origin: bottom; }
        .bar:hover { background-color: #64748b; }
        .bar.accent-gradient { background: linear-gradient(to top, #38bdf8 0%, #0ea5e9 100%); }
        .bar.accent-gradient:hover { filter: brightness(1.2); }
        .day-label { font-size: 0.75rem; color: #94a3b8; position: absolute; bottom: -1.25rem; }
        @keyframes growBar { from { transform: scaleY(0); } to { transform: scaleY(1); } }

        .category-item {
            display: flex;
            align-items: center;
            gap: 0.75rem; /* 12px */
        }
        .category-icon {
            width: 40px;
            height: 40px;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: rgba(15, 23, 42, 0.6); /* bg-slate-900/60 */
            border-radius: 0.5rem; /* rounded-lg */
        }
        .category-progress-bg {
            background-color: #334155; /* bg-slate-700 */
            border-radius: 9999px; /* rounded-full */
            height: 6px;
            overflow: hidden;
        }
        .category-progress-bar {
            height: 100%;
            border-radius: 9999px; /* rounded-full */
            transition: width 0.5s ease-in-out;
        }
        .progress-coding { background-color: #3b82f6; } /* blue-500 */
        .progress-exercise { background-color: #10b981; } /* green-500 */
        .progress-study { background-color: #8b5cf6; } /* violet-500 */
        .progress-project { background-color: #f59e0b; } /* amber-500 */
        .progress-exam { background-color: #ec4899; } /* pink-500 */
        .progress-creativity { background-color: #6366f1; } /* indigo-500 */

        .player-character {
            width: 182px;
            height: 280px;
            z-index: 10; /* Asegura que esté por encima */
        }

        .player-character.sprite {
        }

        #sprites-container {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            padding: 1rem;
            border: 1px solid rgba(56, 189, 248, 0.2);
            background-color: #1e293b;
            border-radius: 0.5rem;
        }

        .sprite {
            transform: scale(0.05);
            transform-origin: top left;
            margin: 0.5rem;
        }
            </style>
</head>

<body>

    <!-- Three.js Portal Container -->
    <div id="world"></div>

    <!-- Welcome Screen -->
    <div id="welcome-wrapper" style="display: none;">
        <div class="welcome-container w-full max-w-md mx-auto rounded-2xl p-8 text-center">
            <h1 class="welcome-title text-5xl font-bold mb-3">The System</h1>
            <p class="text-slate-200 mb-8 leading-relaxed">
                The System awaits your presence.<br>
                If you do not register today, you are likely to die.<br><br>
                Are you ready for synchronization? ⚡
            </p>
            <button id="sync-button" class="sync-button w-full font-bold py-3 px-8 rounded-lg transition-colors duration-300 flex items-center justify-center gap-3 text-lg">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></svg>
                SYNCHRONIZE
            </button>
        </div>
    </div>
    
    <!-- Main Dashboard Container (Initially Hidden) -->
    <div id="dashboard-container" style="display: none; opacity: 0;" class="fade-in">
        <div class="p-4 lg:p-6">
            <div class="mb-4">
                <div class="panel py-1 px-3 flex items-center gap-4">
                    <div class="flex items-baseline gap-2">
                        <div class="text-xs text-slate-400 font-semibold">LEVEL</div>
                        <div id="top-bar-level" class="text-lg font-bold accent-text leading-none">1</div>
                    </div>
                    <div class="flex-grow flex items-center gap-3 px-4">
                        <div class="w-full h-2 bg-slate-900 rounded-full flex-grow">
                            <div id="top-bar-exp" class="accent-gradient h-full rounded-full" style="width: 45%"></div>
                        </div>
                        <div class="text-xs text-slate-400 whitespace-nowrap"><span id="top-bar-current-exp">450</span> / <span id="top-bar-max-exp">1000</span> EXP</div>
                    </div>
                    <div class="text-center bg-slate-700/50 px-2 py-0.5 rounded-md">
                        <div class="text-xs text-slate-400">RANK</div>
                        <div class="text-lg font-bold text-yellow-400 leading-none">E</div>
                    </div>
                    <div class="bg-slate-900/50 py-1 px-3 rounded-lg flex items-center gap-2">
                        <i class="fas fa-fire text-lg text-red-500"></i>
                        <div>
                            <div class="text-xs text-slate-400">STREAK</div>
                            <div class="font-bold text-base text-slate-100 leading-none"><span id="top-bar-streak">0</span> DAYS</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-12 gap-4">
                
                <div class="lg:col-span-2 flex flex-col gap-4">
                    <div class="panel flex-grow flex flex-col p-4 items-center relative group">
                        <div class="player-character sprite" data-sprite-asset="menu" data-sprite-frame="3.png"></div>
                        <button id="prev-char-btn" class="absolute left-2 top-1/4 -translate-y-1/2 bg-slate-800/50 p-2 rounded-full opacity-0 group-hover:opacity-100 transition-opacity z-20">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <button id="next-char-btn" class="absolute right-2 top-1/4 -translate-y-1/2 bg-slate-800/50 p-2 rounded-full opacity-0 group-hover:opacity-100 transition-opacity z-20">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                        
                        

                        <div class="mt-64 w-full">
                            <h1 id="character-name" class="text-2xl font-bold text-white mb-2 text-center neon-text-blue" style="font-family: 'Geo', sans-serif;">CS Student</h1>
                            <div class="w-full space-y-4 text-sm">
                                <div>
                                    <div class="flex justify-between items-center mb-1">
                                        <span class="font-bold text-red-500">HEALTH</span>
                                        <span class="text-sm font-bold text-red-500">100 / 100</span>
                                    </div>
                                    <div class="w-full h-2 bg-slate-900 rounded-full">
                                        <div id="health-bar" class="bg-red-500 h-full rounded-full" style="width: 100%"></div>
                                    </div>
                                </div>
                                <div class="flex items-center justify-between">
                                    <span class="font-bold text-yellow-400">GOLD</span>
                                    <div class="flex items-center gap-1">
                                        <i class="fas fa-coins text-yellow-400"></i>
                                        <span id="gold-count" class="text-lg font-bold">1,250</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="panel">
                        <div class="panel-header flex justify-between items-center">
                            <span class="font-bold neon-text-blue" style="font-family: 'Geo', sans-serif; color: #ffffff; font-size: 0.875rem;">Quick Links</span>
                            <button id="add-website-btn" class="w-7 h-7 bg-slate-700/50 hover:bg-slate-700 text-slate-300 rounded-md transition flex items-center justify-center">
                                <i class="fas fa-plus fa-sm"></i>
                            </button>
                        </div>
                        <div id="quick-links" class="p-2 space-y-2 max-h-60 overflow-y-auto"></div>
                         <div id="add-website-form" class="hidden p-4 bg-[#0f172a]">
                            <input type="text" id="website-name" placeholder="Website Name" class="bg-slate-900 border border-slate-600 text-slate-200 p-2 rounded mb-2 w-full text-sm">
                            <input type="url" id="website-url" placeholder="Website URL" class="bg-slate-900 border border-slate-600 text-slate-200 p-2 rounded mb-2 w-full text-sm">
                            <div class="flex">
                                <button id="save-website" class="accent-gradient hover:opacity-90 text-white font-bold px-3 py-1 rounded-md mr-2 text-sm">Save</button>
                                <button id="cancel-website" class="bg-slate-600 hover:bg-slate-700 text-slate-200 font-bold px-3 py-1 rounded-md text-sm">Cancel</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="lg:col-span-3 flex flex-col gap-4">
                    <div class="panel flex-grow p-4">
                        <h2 class="font-bold neon-text-blue mb-4" style="font-family: 'Geo', sans-serif; text-align: center; color: #ffffff;">Category Breakdown</h2>
                        <div class="flex justify-center items-center h-48 mb-4 bg-slate-900/50 rounded-md">
                            <svg class="w-40 h-40" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M50 10L85 27.5V72.5L50 90L15 72.5V27.5L50 10Z" stroke="#38bdf8" stroke-opacity="0.2"/>
                                <path d="M50 25L72.5 38.75V61.25L50 75L27.5 61.25V38.75L50 25Z" stroke="#38bdf8" stroke-opacity="0.4"/>
                                <path d="M50 10V90" stroke="#38bdf8" stroke-opacity="0.1"/>
                                <path d="M15 27.5L85 72.5" stroke="#38bdf8" stroke-opacity="0.1"/>
                                <path d="M15 72.5L85 27.5" stroke="#38bdf8" stroke-opacity="0.1"/>
                                <path d="M50 25L85 27.5L72.5 61.25L50 90L27.5 61.25L15 27.5L50 25Z" fill="#38bdf8" fill-opacity="0.2"/>
                                <text x="50" y="5" font-family="Rajdhani, sans-serif" font-size="6" fill="#94a3b8" text-anchor="middle">18</text>
                                <text x="90" y="27.5" font-family="Rajdhani, sans-serif" font-size="6" fill="#94a3b8" text-anchor="middle" dominant-baseline="middle">29</text>
                                <text x="90" y="72.5" font-family="Rajdhani, sans-serif" font-size="6" fill="#94a3b8" text-anchor="middle" dominant-baseline="middle">32</text>
                                <text x="50" y="95" font-family="Rajdhani, sans-serif" font-size="6" fill="#94a3b8" text-anchor="middle">43</text>
                                <text x="10" y="72.5" font-family="Rajdhani, sans-serif" font-size="6" fill="#94a3b8" text-anchor="middle" dominant-baseline="middle">18</text>
                                <text x="10" y="27.5" font-family="Rajdhani, sans-serif" font-size="6" fill="#94a3b8" text-anchor="middle" dominant-baseline="middle">44</text>
                            </svg>
                        </div>
                        
                        <div class="space-y-4">

                            
                            <div class="category-item">
                                <div class="category-icon"><i class="fas fa-code text-lg" style="color: #3b82f6;"></i></div>
                                <div class="w-full">
                                    <div class="flex justify-between items-center mb-1">
                                        <span class="font-semibold text-sm text-slate-200">Coding</span>
                                        <span class="text-xs text-slate-400" id="coding-count">0</span>
                                    </div>
                                    <div class="category-progress-bg">
                                        <div class="category-progress-bar progress-coding" style="width: 60%;"></div>
                                    </div>
                                </div>
                            </div>

                            
                            <div class="category-item">
                                <div class="category-icon"><i class="fas fa-dumbbell text-lg" style="color: #10b981;"></i></div>
                                <div class="w-full">
                                    <div class="flex justify-between items-center mb-1">
                                        <span class="font-semibold text-sm text-slate-200">Exercise</span>
                                        <span class="text-xs text-slate-400" id="exercise-count">0</span>
                                    </div>
                                    <div class="category-progress-bg">
                                        <div class="category-progress-bar progress-exercise" style="width: 80%;"></div>
                                    </div>
                                </div>
                            </div>

                            
                            <div class="category-item">
                                <div class="category-icon"><i class="fas fa-book-open text-lg" style="color: #8b5cf6;"></i></div>
                                <div class="w-full">
                                    <div class="flex justify-between items-center mb-1">
                                        <span class="font-semibold text-sm text-slate-200">Study</span>
                                        <span class="text-xs text-slate-400" id="study-count">0</span>
                                    </div>
                                    <div class="category-progress-bg">
                                        <div class="category-progress-bar progress-study" style="width: 45%;"></div>
                                    </div>
                                </div>
                            </div>

                            
                            <div class="category-item">
                                <div class="category-icon"><i class="fas fa-tasks text-lg" style="color: #f59e0b;"></i></div>
                                <div class="w-full">
                                    <div class="flex justify-between items-center mb-1">
                                        <span class="font-semibold text-sm text-slate-200">Projects</span>
                                        <span class="text-xs text-slate-400" id="project-count">0</span>
                                    </div>
                                    <div class="category-progress-bg">
                                        <div class="category-progress-bar progress-project" style="width: 70%;"></div>
                                    </div>
                                </div>
                            </div>

                            
                            <div class="category-item">
                                <div class="category-icon"><i class="fas fa-file-alt text-lg" style="color: #ec4899;"></i></div>
                                <div class="w-full">
                                    <div class="flex justify-between items-center mb-1">
                                        <span class="font-semibold text-sm text-slate-200">Exams</span>
                                        <span class="text-xs text-slate-400" id="exam-count">0</span>
                                    </div>
                                    <div class="category-progress-bg">
                                        <div class="category-progress-bar progress-exam" style="width: 90%;"></div>
                                    </div>
                                </div>
                            </div>

                            
                            <div class="category-item">
                                <div class="category-icon"><i class="fas fa-lightbulb text-lg" style="color: #6366f1;"></i></div>
                                <div class="w-full">
                                    <div class="flex justify-between items-center mb-1">
                                        <span class="font-semibold text-sm text-slate-200">Creativity</span>
                                        <span class="text-xs text-slate-400" id="creativity-count">0</span>
                                    </div>
                                    <div class="category-progress-bg">
                                        <div class="category-progress-bar progress-creativity" style="width: 55%;"></div>
                                    </div>
                                </div>
                            </div>
                            
                        </div>
                    </div>
                </div>

                <div class="lg:col-span-7 flex flex-col gap-4">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
                        <div class="flex flex-col gap-4">
                            <div class="panel p-4 h-48 flex flex-col">
                                <button id="expand-calendar-btn" class="text-slate-400 hover:text-white" style="position: absolute; top: 10px; right: 10px;"><i class="fas fa-expand-arrows-alt"></i></button>
                                <div class="flex justify-center items-center mb-2">
                                    <div id="calendar-header" class="font-bold text-sm neon-text-blue" style="font-family: 'Geo', sans-serif; text-align: center; color: #ffffff; font-size: 0.875rem;"></div>
                                </div>
                                 <div id="calendar-grid" class="grid grid-cols-7 gap-1 text-center flex-grow"></div>
                            </div>
                             <div class="panel p-4 h-48 flex flex-col">
                                <h3 class="font-bold neon-text-blue mb-2" style="font-family: 'Geo', sans-serif; text-align: center; color: #ffffff;">Weekly Activity</h3>
                                <div class="flex-grow flex items-end justify-around">
                                    <div class="bar-container h-full"><div class="bar" style="height: 40%; animation-delay: 0.1s;"></div><span class="day-label">M</span></div>
                                    <div class="bar-container h-full"><div class="bar" style="height: 60%; animation-delay: 0.2s;"></div><span class="day-label">T</span></div>
                                    <div class="bar-container h-full"><div class="bar accent-gradient" style="height: 85%; animation-delay: 0.3s;"></div><span class="day-label">W</span></div>
                                    <div class="bar-container h-full"><div class="bar" style="height: 50%; animation-delay: 0.4s;"></div><span class="day-label">T</span></div>
                                    <div class="bar-container h-full"><div class="bar" style="height: 70%; animation-delay: 0.5s;"></div><span class="day-label">F</span></div>
                                    <div class="bar-container h-full"><div class="bar" style="height: 20%; animation-delay: 0.6s;"></div><span class="day-label">S</span></div>
                                    <div class="bar-container h-full"><div class="bar" style="height: 30%; animation-delay: 0.7s;"></div><span class="day-label">S</span></div>
                                </div>
                            </div>
                        </div>
                        <div class="panel flex flex-col">
                            <div class="panel-header flex justify-between items-center"><span class="font-bold neon-text-blue" style="font-family: 'Geo', sans-serif; color: #ffffff; font-size: 0.875rem;">System Messages</span><i class="fas fa-terminal accent-text"></i></div>
                            <div id="day-selector" class="flex justify-around p-2 bg-slate-900/50"></div>
                            <div id="system-messages" class="p-2 space-y-2 flex-grow overflow-y-auto"></div>
                            <div class="p-2 border-t border-slate-700/50"><button id="clear-messages" class="text-xs text-slate-400 hover:text-white transition w-full text-center"><i class="fas fa-trash mr-1"></i> Clear Messages</button></div>
                        </div>
                    </div>
                    <div class="grid grid-cols-3 gap-4">
                        <div class="panel" style="width: 160px; height: 177px;">
                            <div class="sprite" data-sprite-asset="menu_1" data-sprite-frame="1.png"></div>
                        </div>
                        <div class="panel" style="width: 160px; height: 177px;">
                            <div class="sprite" data-sprite-asset="menu_1" data-sprite-frame="3.png"></div>
                        </div>
                        <div class="panel p-4 h-48">
                            <h3 class="font-bold text-center neon-text-blue mb-4" style="font-family: 'Geo', sans-serif; color: #ffffff;">This Month's Achievements</h3>
                            <div class="space-y-3">
                                <div class="achievement-item"><div class="achievement-icon"><i class="fas fa-gift accent-text"></i></div><div class="flex-grow"><div class="font-bold text-slate-200 text-sm">Treasure Box</div><div class="text-xs text-slate-400">Lottery unlocked</div></div><div class="font-bold accent-text">1</div></div>
                                <div class="achievement-item"><div class="achievement-icon"><i class="fas fa-check-double accent-text"></i></div><div class="flex-grow"><div class="font-bold text-slate-200 text-sm">Daily Goals</div><div class="text-xs text-slate-400">Goals achieved</div></div><div class="font-bold accent-text">26</div></div>
                                <div class="achievement-item"><div class="achievement-icon"><i class="fas fa-medal accent-text"></i></div><div class="flex-grow"><div class="font-bold text-slate-200 text-sm">Badge Earned</div><div class="text-xs text-slate-400">"LeetCoder" Badge</div></div><div class="font-bold accent-text">1</div></div>
                            </div>
                        </div>
                        <div class="panel" style="width: 160px; height: 177px;">
                            <div class="sprite" data-sprite-asset="menu_1" data-sprite-frame="2.png"></div>
                        </div>
                        <div class="panel" style="width: 160px; height: 177px;">
                            <div class="sprite" data-sprite-asset="menu_1" data-sprite-frame="4.png"></div>
                        </div>
                    </div>
                </div>
                <div class="lg:col-span-12 panel">
                     <div class="panel-header"><span class="font-bold neon-text-blue" style="font-family: 'Geo', sans-serif; color: #ffffff; font-size: 0.875rem;">Projects</span></div>
                     <div class="p-2 space-y-2">
                        <div class="project-item"><div class="project-icon flex-shrink-0"><i class="fas fa-atom text-xl accent-text"></i></div><div class="flex-grow min-w-0"><div class="font-bold text-slate-100 truncate">Nova Prospekt</div><div class="text-xs text-slate-400">Sunday, 12 November 2004</div></div><div class="w-28 flex-shrink-0 text-sm text-slate-300 hidden sm:block">20 Members</div><div class="w-32 flex-shrink-0 text-sm font-semibold hidden md:block"><span class="difficulty-hard">Difficult: Hard</span></div><div class="w-32 flex-shrink-0 text-sm text-slate-400 hidden lg:block">Antlion Horde</div><button class="flex-shrink-0 text-slate-500 hover:text-white w-8 text-center"><i class="fas fa-ellipsis-h"></i></button></div>
                        <div class="project-item"><div class="project-icon flex-shrink-0"><i class="fas fa-biohazard text-xl accent-text"></i></div><div class="flex-grow min-w-0"><div class="font-bold text-slate-100 truncate">Black Mesa East</div><div class="text-xs text-slate-400">Friday, 06 December 2020</div></div><div class="w-28 flex-shrink-0 text-sm text-slate-300 hidden sm:block">75 Members</div><div class="w-32 flex-shrink-0 text-sm font-semibold hidden md:block"><span class="difficulty-insane">Difficult: Insane</span></div><div class="w-32 flex-shrink-0 text-sm text-slate-400 hidden lg:block">G-Man</div><button class="flex-shrink-0 text-slate-500 hover:text-white w-8 text-center"><i class="fas fa-ellipsis-h"></i></button></div>
                     </div>
                </div>
                <div class="lg:col-span-12 text-center py-4">
                    <div class="flex items-center justify-center gap-2 mb-1">
                        <i class="fas fa-exclamation-triangle text-red-500 text-lg"></i>
                        <h3 class="text-lg font-bold text-red-500">Warning</h3>
                    </div>
                    <p class="text-sm text-slate-400 mb-2">Failure to complete the daily quest will result in an appropriate <span class="text-red-500 font-semibold">penalty</span>.</p>
                    <div id="reset-timer-large" class="text-2xl font-bold text-slate-100 tracking-wider">23:59:59</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // --- THREE.JS SCENE SETUP ---
            var scene, camera, renderer, composer, material, bloomPass;
            var width = window.innerWidth;
            var height = window.innerHeight;
            var options = { exposure: 2.8, bloomStrength: 1.7, bloomThreshold: 0, bloomRadius: 0.5, color0: [10, 15, 30], color1: [20, 40, 90], color2: [40, 100, 200], color3: [103, 232, 249], color4: [255, 255, 255], color5: [5, 10, 20], };
            const vert = `varying vec3 vNormal; varying vec3 camPos; varying vec2 vUv; void main() { vNormal = normal; vUv = uv; camPos = cameraPosition; gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 ); }`;
            const frag = `#define NUM_OCTAVES 5
#define M_PI 3.1415926535897932384626433832795
uniform vec4 resolution; varying vec3 vNormal; uniform sampler2D perlinnoise; uniform sampler2D sparknoise; uniform sampler2D waterturbulence; uniform sampler2D noiseTex; uniform float time; uniform vec3 color0; uniform vec3 color1; uniform vec3 color2; uniform vec3 color3; uniform vec3 color4; uniform vec3 color5; varying vec3 camPos; varying vec2 vUv; float rand(vec2 n) { return fract(sin(dot(n, vec2(12.9898, 4.1414))) * 43758.5453); } float noise(vec2 p){ vec2 ip = floor(p); vec2 u = fract(p); u = u*u*(3.0-2.0*u); float res = mix(mix(rand(ip),rand(ip+vec2(1.0,0.0)),u.x), mix(rand(ip+vec2(0.0,1.0)),rand(ip+vec2(1.0,1.0)),u.x),u.y); return res*res; } float fbm(vec2 x) { float v = 0.0; float a = 0.5; vec2 shift = vec2(100); mat2 rot = mat2(cos(0.5), sin(0.5), -sin(0.5), cos(0.50)); for (int i = 0; i < NUM_OCTAVES; ++i) { v += a * noise(x); x = rot * x * 2.0 + shift; a *= 0.5; } return v; } float setOpacity(float r, float g, float b, float tonethreshold) { float tone = (r + g + b) / 3.0; float alpha = 1.0; if(tone<tonethreshold) { alpha = 0.0; } return alpha; } vec3 rgbcol(vec3 col) { return vec3(col.r/255.0,col.g/255.0,col.b/255.0); } vec2 rotate(vec2 v, float a) { float s = sin(a); float c = cos(a); mat2 m = mat2(c, -s, s, c); return m * v; } vec2 UnityPolarCoordinates (vec2 UV, vec2 Center, float RadialScale, float LengthScale){ vec2 delta = UV - Center; float radius = length(delta) * 2. * RadialScale; float angle = atan(delta.x, delta.y) * 1.0/6.28 * LengthScale; return vec2(radius, angle); } void main() { vec2 olduv = gl_FragCoord.xy/resolution.xy; vec2 uv = vUv; float scale = 1.; olduv *= 0.5 + time; vec2 p = olduv*scale; float pct = distance(vUv,vec2(0.5)); vec3 rgbcolor0 = rgbcol(color0); vec3 rgbcolor1 = rgbcol(color1); vec3 rgbcolor2 = rgbcol(color2); vec3 rgbcolor3 = rgbcol(color3); vec3 rgbcolor4 = rgbcol(color4); vec3 rgbcolor5 = rgbcol(color5); float y = smoothstep(0.16,0.525,pct); vec3 backcolor = mix(rgbcolor0, rgbcolor5, y); gl_FragColor = vec4(backcolor,1.); vec2 center = vec2(0.5); vec2 cor = UnityPolarCoordinates(vUv, center, 1., 1.); vec2 newvUv = vUv - 0.5; vec3 noisetexvUv = texture2D(perlinnoise,mod(rotate(newvUv*0.15 + vec2(sin(time*0.005),cos(time*0.005)),time),1.)).rgb; vec2 newUv = vec2(cor.x + time,cor.x+cor.y); vec3 noisetex = texture2D(perlinnoise,mod(newUv,1.)).rgb; vec3 noisetex2 = texture2D(sparknoise,mod(newUv,1.)).rgb; vec3 noisetex3 = texture2D(waterturbulence,mod(newUv,1.)).rgb; float tone0 = 1. - smoothstep(0.3,0.6,noisetex.r); float tone1 = smoothstep(0.3,0.6,noisetex2.r); float tone2 = smoothstep(0.3,0.6,noisetex3.r); float opacity0 = setOpacity(tone0,tone0,tone0,.29); float opacity1 = setOpacity(tone1,tone1,tone1,.49); float opacity2 = setOpacity(tone2,tone2,tone2,.69); float gradienttone = 1. - smoothstep(0.196,0.532,pct); vec4 circularnoise = vec4( vec3(gradienttone)*noisetexvUv*1.4, 1.0 ); float gradopacity = setOpacity(circularnoise.r,circularnoise.g,circularnoise.b,0.19); vec2 uv2 = uv; float iTime = time*0.004; uv.y += iTime / 10.0; uv.x -= (sin(iTime/10.0)/2.0); uv2.x += iTime / 14.0; uv2.x += (sin(iTime/10.0)/9.0); float result = 0.0; result += texture2D(noiseTex, mod(uv*0.5,1.) * 0.6 + vec2(iTime*-0.003)).r; result *= texture2D(noiseTex, mod(uv2*0.5,1.) * 0.9 + vec2(iTime*+0.002)).b; result = pow(result, 4.0); if(opacity2>0.0){ gl_FragColor = vec4(rgbcolor4,0.)*vec4(opacity2); } else if(opacity1>0.0){ gl_FragColor = vec4(rgbcolor2,0.)*vec4(opacity1); } else if(opacity0>0.0){ gl_FragColor = vec4(rgbcolor1,0.)*vec4(opacity0); } gl_FragColor += vec4(108.0)*result*(y*0.02); gl_FragColor *= vec4(gradopacity); }`;
        
            function isWebGLAvailable() { try { const canvas = document.createElement('canvas'); return !!(window.WebGLRenderingContext && (canvas.getContext('webgl') || canvas.getContext('experimental-webgl'))); } catch (e) { return false; } }
            function initThree() { scene = new THREE.Scene(); camera = new THREE.PerspectiveCamera(75, width / height, 0.1, 10000); camera.position.z = 5; renderer = new THREE.WebGLRenderer({ antialias: true }); renderer.setPixelRatio(window.devicePixelRatio); renderer.setSize(width, height); renderer.autoClear = false; document.getElementById("world").appendChild(renderer.domElement); material = new THREE.ShaderMaterial({ uniforms: { time: { value: 0.0 }, perlinnoise: { value: new THREE.TextureLoader().load('https://raw.githubusercontent.com/pizza3/asset/master/noise9.png') }, sparknoise: { value: new THREE.TextureLoader().load('https://raw.githubusercontent.com/pizza3/asset/master/sparklenoise.png') }, waterturbulence: { value: new THREE.TextureLoader().load('https://raw.githubusercontent.com/pizza3/asset/master/waterturbulence.png') }, noiseTex: { value: new THREE.TextureLoader().load('https://raw.githubusercontent.com/pizza3/asset/master/rgbnoise2.png') }, color5: { value: new THREE.Vector3(...options.color5) }, color4: { value: new THREE.Vector3(...options.color4) }, color3: { value: new THREE.Vector3(...options.color3) }, color2: { value: new THREE.Vector3(...options.color2) }, color1: { value: new THREE.Vector3(...options.color1) }, color0: { value: new THREE.Vector3(...options.color0) }, resolution: { value: new THREE.Vector2(width, height) }, }, fragmentShader: frag, vertexShader: vert, }); var planegeometry = new THREE.PlaneGeometry(10, 10, 1, 1); var plane = new THREE.Mesh(planegeometry, material); scene.add(plane); var renderScene = new THREE.RenderPass(scene, camera); bloomPass = new THREE.UnrealBloomPass(new THREE.Vector2(width, height), 1.5, 0.4, 0.85); bloomPass.threshold = options.bloomThreshold; bloomPass.strength = options.bloomStrength; bloomPass.radius = options.bloomRadius; composer = new THREE.EffectComposer(renderer); composer.addPass(renderScene); composer.addPass(bloomPass); }
            function animateThree() { requestAnimationFrame(animateThree); var time = performance.now() * 0.0001; material.uniforms['time'].value = time; composer.render(); }

            const welcomeWrapperEl = document.getElementById('welcome-wrapper');
            const worldEl = document.getElementById('world');
            const dashboardContainerEl = document.getElementById('dashboard-container');
            const syncButtonEl = document.getElementById('sync-button');

            const lastSync = localStorage.getItem('lastSyncDate');
            const today = new Date().toDateString();

            const showDashboard = () => {
                welcomeWrapperEl.style.display = 'none';
                if (worldEl) worldEl.style.display = 'none';
                dashboardContainerEl.style.display = 'block';
                requestAnimationFrame(() => {
                    dashboardContainerEl.classList.add('fade-in');
                });
                initializeDashboard();
            };

            function updateStreakData() {
                const dayStates = JSON.parse(localStorage.getItem('questLogDayStates')) || {};
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                let currentStreak = 0, recordStreak = 0, tempStreak = 0;
                const sortedDates = Object.keys(dayStates)
                    .filter(key => dayStates[key] === 'completed')
                    .map(key => {
                        const parts = key.split('-').map(Number);
                        return new Date(parts[0], parts[1], parts[2]);
                    })
                    .sort((a, b) => a - b);
                if (sortedDates.length > 0) {
                    tempStreak = 1; recordStreak = 1;
                    for (let i = 1; i < sortedDates.length; i++) {
                        const diff = (sortedDates[i] - sortedDates[i-1]) / (1000 * 60 * 60 * 24);
                        if (diff === 1) tempStreak++; else tempStreak = 1;
                        if (tempStreak > recordStreak) recordStreak = tempStreak;
                    }
                    const lastCompletedDate = sortedDates[sortedDates.length - 1];
                    const diffFromToday = (today - lastCompletedDate) / (1000 * 60 * 60 * 24);
                    if (diffFromToday <= 1) currentStreak = tempStreak; else currentStreak = 0;
                }
                localStorage.setItem('playerStreak', currentStreak);
                localStorage.setItem('playerRecordStreak', recordStreak);
            }

            if (lastSync === today) {
                showDashboard();
            } else {
                welcomeWrapperEl.style.display = 'flex';
                if (isWebGLAvailable()) {
                    try { initThree(); animateThree(); } catch (e) {
                        console.error("Three.js initialization failed:", e);
                        if(worldEl) worldEl.style.display = 'none';
                    }
                } else {
                    console.warn("WebGL is not supported. 3D background is disabled.");
                    if(worldEl) worldEl.style.display = 'none';
                }

                syncButtonEl.addEventListener('click', () => {
                    localStorage.setItem('lastSyncDate', today);
                    const dayStates = JSON.parse(localStorage.getItem('questLogDayStates')) || {};
                    const todayDate = new Date();
                    const todayKey = `${todayDate.getFullYear()}-${todayDate.getMonth()}-${todayDate.getDate()}`;
                    dayStates[todayKey] = 'completed';
                    localStorage.setItem('questLogDayStates', JSON.stringify(dayStates));
                    updateStreakData();

                    welcomeWrapperEl.classList.add('fade-out');
                    if (worldEl) worldEl.classList.add('fade-out');
                    setTimeout(showDashboard, 1500);
                });
            }

            function initializeDashboard() {
                let playerState = { level: 1, currentExp: 0, websites: [], deletedDefaultWebsites: [], categoryCounts: { coding: 0, exercise: 0, study: 0, project: 0, exam: 0, creativity: 0 }, tasksToday: 0, totalQuests: 0 };
                const defaultWebsites = [ { id: 'd1', name: 'GitHub', url: 'https://github.com', icon: 'https://github.githubassets.com/favicons/favicon.png' }, { id: 'd2', name: 'LeetCode', url: 'https://leetcode.com', icon: 'https://leetcode.com/favicon.ico' }, { id: 'd3', name: 'Stack Overflow', url: 'https://stackoverflow.com', icon: 'https://stackoverflow.com/favicon.ico' }, { id: 'd4', name: 'YouTube', url: 'https://www.youtube.com', icon: 'https://www.youtube.com/favicon.ico' } ];
                const elements = { topBarLevel: document.getElementById('top-bar-level'), topBarExp: document.getElementById('top-bar-exp'), topBarCurrentExp: document.getElementById('top-bar-current-exp'), topBarMaxExp: document.getElementById('top-bar-max-exp'), topBarStreak: document.getElementById('top-bar-streak'), totalQuests: document.getElementById('total-quests'), nextRewardExpDisplay: document.getElementById('next-reward-exp-display'), tasksToday: document.getElementById('tasks-today'), bestStreak: document.getElementById('best-streak'), quickLinks: document.getElementById('quick-links'), addWebsiteBtn: document.getElementById('add-website-btn'), addWebsiteForm: document.getElementById('add-website-form'), saveWebsiteBtn: document.getElementById('save-website'), cancelWebsiteBtn: document.getElementById('cancel-website'), websiteNameInput: document.getElementById('website-name'), websiteUrlInput: document.getElementById('website-url'), systemMessages: document.getElementById('system-messages'), clearMessagesBtn: document.getElementById('clear-messages'), codingCount: document.getElementById('coding-count'), exerciseCount: document.getElementById('exercise-count'), studyCount: document.getElementById('study-count'), projectCount: document.getElementById('project-count'), examCount: document.getElementById('exam-count'), creativityCount: document.getElementById('creativity-count'), calendarHeader: document.getElementById('calendar-header'), calendarGrid: document.getElementById('calendar-grid'), resetTimerLarge: document.getElementById('reset-timer-large'), daySelector: document.getElementById('day-selector'), expandCalendarBtn: document.getElementById('expand-calendar-btn'), };
                
                function loadState() { const savedState = JSON.parse(localStorage.getItem('csDungeonStateV3')); if (savedState) playerState = { ...playerState, ...savedState }; }
                function saveState() { localStorage.setItem('csDungeonStateV3', JSON.stringify(playerState)); }
                function calculateMaxExp(level) { return level * 200 + 800; }
                function renderUI() { const maxExp = calculateMaxExp(playerState.level); elements.topBarLevel.textContent = playerState.level; elements.topBarCurrentExp.textContent = playerState.currentExp; elements.topBarMaxExp.textContent = maxExp; elements.topBarExp.style.width = `${(playerState.currentExp / maxExp) * 100}%`; const savedStreak = localStorage.getItem('playerStreak') || 0; const savedRecord = localStorage.getItem('playerRecordStreak') || 0; elements.topBarStreak.textContent = savedStreak;     for (const category in playerState.categoryCounts) { const count = playerState.categoryCounts[category] || 0; const progress = count % 100; const countElementKey = `${category}Count`; if (elements[countElementKey]) { elements[countElementKey].textContent = count; } const progressBarElementKey = `${category}ProgressBar`; if (elements[progressBarElementKey]) { elements[progressBarElementKey].style.width = `${progress}%`; } } renderWebsites(); }
                function levelUp(newLevel) { elements.topBarLevel.classList.add('level-up-animation'); setTimeout(() => { elements.topBarLevel.classList.remove('level-up-animation'); }, 1500); addSystemMessage(`Congratulations! You reached Level ${newLevel}!`, 'success'); }
                function addExp(amount) { let maxExp = calculateMaxExp(playerState.level); playerState.currentExp += amount; while (playerState.currentExp >= maxExp) { playerState.currentExp -= maxExp; playerState.level++; maxExp = calculateMaxExp(playerState.level); levelUp(playerState.level); } }
                function renderCalendar() { const now = new Date(); const monthName = now.toLocaleString('default', { month: 'long' }); const capitalizedMonth = monthName.charAt(0).toUpperCase() + monthName.slice(1); elements.calendarHeader.textContent = `${capitalizedMonth}`; elements.calendarGrid.innerHTML = ''; const daysOfWeek = ['M', 'T', 'W', 'T', 'F', 'S', 'S']; daysOfWeek.forEach(day => { elements.calendarGrid.innerHTML += `<div class="calendar-day-name">${day}</div>`; }); const firstDayOfMonth = new Date(now.getFullYear(), now.getMonth(), 1).getDay(); const daysInMonth = new Date(now.getFullYear(), now.getMonth() + 1, 0).getDate(); const startOffset = (firstDayOfMonth === 0) ? 6 : firstDayOfMonth - 1; for (let i = 0; i < startOffset; i++) { elements.calendarGrid.innerHTML += `<div></div>`; } for (let day = 1; day <= daysInMonth; day++) { const dayClass = day === now.getDate() ? 'calendar-day today' : 'calendar-day'; elements.calendarGrid.innerHTML += `<div class="${dayClass}">${day}</div>`; } }
                function renderWebsites() { elements.quickLinks.innerHTML = ''; const visibleDefaultWebsites = defaultWebsites.filter(site => !playerState.deletedDefaultWebsites.includes(site.id)); const allLinks = [...visibleDefaultWebsites, ...playerState.websites]; allLinks.forEach(site => { const iconSrc = site.icon || `https://www.google.com/s2/favicons?domain=${site.url}&sz=32`; const linkEl = document.createElement('div'); linkEl.className = 'relative flex items-center p-2 rounded-md hover:bg-slate-700/50 cursor-pointer group'; linkEl.innerHTML = `<img src="${iconSrc}" class="w-5 h-5 mr-2 rounded-sm" onerror="this.src='https://www.google.com/s2/favicons?domain=google.com&sz=32'"><span class="text-sm text-slate-200 flex-grow">${site.name}</span>`; linkEl.onclick = () => window.open(site.url, '_blank'); const deleteBtn = document.createElement('button'); deleteBtn.className = 'w-6 h-6 bg-red-500/80 text-white rounded-md flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity'; deleteBtn.innerHTML = '<i class="fas fa-times text-xs"></i>'; deleteBtn.onclick = (e) => { e.stopPropagation(); deleteWebsite(site.id); }; linkEl.appendChild(deleteBtn); elements.quickLinks.appendChild(linkEl); }); }
                function addSystemMessage(text, type = 'system') { const message = document.createElement('div'); let icon = 'fa-info-circle', colorClass = 'accent-text'; if (text.startsWith('SUCCESS:')) { type = 'success'; text = text.replace('SUCCESS: ', ''); } if (text.startsWith('ALERT:')) { type = 'danger'; text = text.replace('ALERT: ', ''); } if (type === 'success') { icon = 'fa-check-circle'; colorClass = 'text-green-400'; } else if (type === 'danger') { icon = 'fa-exclamation-triangle'; colorClass = 'text-red-400'; } message.className = `text-xs text-slate-300 flex items-start`; message.innerHTML = `<i class="fas ${icon} ${colorClass} mr-2 mt-1"></i><span>${text}</span>`; elements.systemMessages.appendChild(message); elements.systemMessages.scrollTop = elements.systemMessages.scrollHeight; }
                function renderDaySelector() { const days = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun']; const now = new Date(); const todayIndex = (now.getDay() + 6) % 7; const mondayDate = new Date(now); mondayDate.setDate(now.getDate() - todayIndex); elements.daySelector.innerHTML = ''; days.forEach((day, index) => { const tab = document.createElement('div'); tab.className = 'day-selector-tab'; if (index === todayIndex) { tab.classList.add('active'); } const currentTabDate = new Date(mondayDate); currentTabDate.setDate(mondayDate.getDate() + index); const dateNumber = currentTabDate.getDate(); tab.innerHTML = `<div class="text-xs">${day}</div><div class="font-bold text-lg leading-none">${dateNumber}</div>`; tab.dataset.dayIndex = index; tab.addEventListener('click', () => selectDay(index)); elements.daySelector.appendChild(tab); }); selectDay(todayIndex); }
                function selectDay(dayIndex) { document.querySelectorAll('.day-selector-tab').forEach(tab => tab.classList.remove('active')); document.querySelector(`.day-selector-tab[data-day-index='${dayIndex}']`).classList.add('active'); elements.systemMessages.innerHTML = ''; showMessagesForDay(dayIndex); }
                function showMessagesForDay(dayIndex) { const messages = { 0: ["Welcome to a new week! Let's start strong. Challenge: Solve one medium LeetCode problem.", "Reminder: Project meeting at 3 PM."], 1: ["Today's focus: Data Structures. Review trees and graphs.", "SYSTEM: Dashboard loaded. Ready to tackle new quests!"], 2: ["Mid-week check-in! How's your progress on Project Borealis?", "Don't forget your workout session."], 3: ["Almost there! Prepare for tomorrow's quiz on algorithms.", "SYSTEM: New quick link 'Dev.to' added."], 4: ["Friday! Time to wrap up weekly tasks and push to GitHub.", "SUCCESS: Task completed! +150 EXP in project."], 5: ["Weekend coding session: Work on a personal project.", "ALERT: Streak of 12 broken! Complete a task to start anew."], 6: ["Rest and recharge. Plan for the upcoming week."] }; if (messages[dayIndex] && messages[dayIndex].length > 0) { messages[dayIndex].forEach(msg => addSystemMessage(msg)); } else { addSystemMessage("No messages for this day."); } }
                function clearMessages() { const activeTab = document.querySelector('.day-selector-tab.active'); if (activeTab) { selectDay(parseInt(activeTab.dataset.dayIndex)); } }

                function toggleWebsiteForm(show) {
                    if (show) {
                        elements.addWebsiteForm.classList.remove('hidden');
                        elements.websiteNameInput.focus();
                    } else {
                        elements.addWebsiteForm.classList.add('hidden');
                        elements.websiteNameInput.value = '';
                        elements.websiteUrlInput.value = '';
                    }
                }

                function handleAddWebsite() {
                    const name = elements.websiteNameInput.value.trim();
                    let url = elements.websiteUrlInput.value.trim();
                    if (name && url) {
                        if (!/^https?:\/\//i.test(url)) {
                            url = 'https://' + url;
                        }

                        try {
                            new URL(url);
                        } catch (_) {
                            addSystemMessage('ALERT: Please enter a valid URL.', 'danger');
                            return;
                        }
                        
                        const newSite = {
                            id: `c${Date.now()}`,
                            name: name,
                            url: url,
                            icon: `https://www.google.com/s2/favicons?domain=${new URL(url).hostname}&sz=32`
                        };
                        playerState.websites.push(newSite);
                        saveState();
                        renderWebsites();
                        toggleWebsiteForm(false);
                        addSystemMessage(`SUCCESS: Quick link '${name}' added.`, 'success');
                    }
                }

                function deleteWebsite(id) {
                    if (id.startsWith('d')) {
                        if (!playerState.deletedDefaultWebsites.includes(id)) {
                            playerState.deletedDefaultWebsites.push(id);
                        }
                    } else {
                        playerState.websites = playerState.websites.filter(site => site.id !== id);
                    }
                    saveState();
                    renderWebsites();
                    addSystemMessage('Quick link removed.', 'system');
                }

                loadState();
                renderUI();
                renderCalendar();
                renderDaySelector();
                setInterval(() => { const now = new Date(); const endOfDay = new Date(now.getFullYear(), now.getMonth(), now.getDate() + 1, 0, 0, 0); const diff = endOfDay - now; const h = Math.floor((diff / (1000 * 60 * 60)) % 24).toString().padStart(2, '0'); const m = Math.floor((diff / 1000 / 60) % 60).toString().padStart(2, '0'); const s = Math.floor((diff / 1000) % 60).toString().padStart(2, '0'); if (elements.resetTimerLarge) { elements.resetTimerLarge.textContent = `${h}:${m}:${s}`; } }, 1000);
                elements.expandCalendarBtn.addEventListener('click', () => { window.location.href = 'calendar.html'; });
                elements.addWebsiteBtn.addEventListener('click', () => toggleWebsiteForm(true));
                elements.cancelWebsiteBtn.addEventListener('click', () => toggleWebsiteForm(false));
                elements.saveWebsiteBtn.addEventListener('click', handleAddWebsite);
                elements.clearMessagesBtn.addEventListener('click', clearMessages);

                
            }
        });
    </script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const spriteConfigurations = {
                "menu": { // Configurations for the 'menu' asset
                    "1.PNG": { targetWidth: 220, targetHeight: 320 },
                    "3.png": { left: '45%', targetWidth: 190, targetHeight: 290 },
                    "4.png": { targetWidth: 242, targetHeight: 352 },
                    "5.png": { targetWidth: 230, targetHeight: 280, left: '40%' },
                    "6.png": { left: '45%', targetWidth: 192, targetHeight: 290 },
                },
                "menu_1": { // Configurations for the 'menu_1' asset
                    "1.png": { targetWidth: 166, targetHeight: 188, left: '45%', top: '45%' },
                    "2.png": { targetWidth: 166, targetHeight: 188, left: '45%', top: '45%' },
                    "3.png": { targetWidth: 166, targetHeight: 188, left: '45%', top: '45%' },
                    "4.png": { targetWidth: 166, targetHeight: 188, left: '45%', top: '45%' },
                }
            };

            const characterNames = {
                "1.PNG": "Sung Jin-woo",
                "2.png": "Lee Joohee",
                "3.png": "Yoo Jin-ho",
                "4.png": "Choi Jong-in",
                "5.png": "Esil Radiru",
                "6.png": "Baek Yoonho",
            };

            const spriteElements = document.querySelectorAll('.sprite');
            const mainCharacterSprite = document.querySelector('.player-character.sprite[data-sprite-asset="menu"]');

            spriteElements.forEach(spriteElement => {
                loadSprite(spriteElement);
            });

            if (mainCharacterSprite) {
                const prevBtn = document.getElementById('prev-char-btn');
                const nextBtn = document.getElementById('next-char-btn');
                let characterFrames = [];
                let currentCharIndex = 0;

                fetch('../../99.Game/assets/menu.json')
                    .then(response => response.json())
                    .then(data => {
                        characterFrames = Object.keys(data.frames);
                        currentCharIndex = characterFrames.indexOf(mainCharacterSprite.dataset.spriteFrame);
                        updateCharacterName(mainCharacterSprite.dataset.spriteFrame);

                        prevBtn.addEventListener('click', () => {
                            currentCharIndex = (currentCharIndex - 1 + characterFrames.length) % characterFrames.length;
                            const newFrame = characterFrames[currentCharIndex];
                            mainCharacterSprite.dataset.spriteFrame = newFrame;
                            loadSprite(mainCharacterSprite);
                            updateCharacterName(newFrame);
                        });

                        nextBtn.addEventListener('click', () => {
                            currentCharIndex = (currentCharIndex + 1) % characterFrames.length;
                            const newFrame = characterFrames[currentCharIndex];
                            mainCharacterSprite.dataset.spriteFrame = newFrame;
                            loadSprite(mainCharacterSprite);
                            updateCharacterName(newFrame);
                        });
                    });
            }

            function updateCharacterName(frameName) {
                const characterNameEl = document.getElementById('character-name');
                if (characterNameEl) {
                    characterNameEl.textContent = characterNames[frameName] || "CS Student";
                }
            }

            function loadSprite(spriteElement) {
                const asset = spriteElement.dataset.spriteAsset;
                const frameName = spriteElement.dataset.spriteFrame;

                console.log(`Loading sprite: asset=${asset}, frameName=${frameName}`);

                if (!asset || !frameName) {
                    console.log("Asset or frameName is missing.");
                    return;
                }

                const jsonUrl = `../../99.Game/assets/${asset}.json`;
                const imageUrl = `../../99.Game/assets/${asset}.png`;

                console.log(`Fetching JSON from: ${jsonUrl}`);
                console.log(`Image URL: ${imageUrl}`);

                fetch(jsonUrl)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }
                        return response.json();
                    })
                    .then(data => {
                        console.log("JSON data loaded:", data);
                        let frameData;
                        for (const key in data.frames) {
                            if (key.toLowerCase() === frameName.toLowerCase()) {
                                frameData = data.frames[key];
                                break;
                            }
                        }

                        if (frameData) {
                            console.log("Frame data found:", frameData);
                            const { frame, sourceSize, spriteSourceSize, trimmed, rotated } = frameData;
                            const spritesheetWidth = data.meta.size.w;
                            const spritesheetHeight = data.meta.size.h;

                            spriteElement.style.backgroundImage = `url('${imageUrl}')`;
                            spriteElement.style.backgroundRepeat = 'no-repeat';

                            if (asset === 'menu') { // Specific logic for 'menu' asset (CS Student)
                                console.log("Applying 'menu' asset logic.");
                                
                                const frameW = rotated ? frame.h : frame.w;
                                const frameH = rotated ? frame.w : frame.h;

                                // Set the element's dimensions to the frame's dimensions
                                spriteElement.style.width = `${frameW}px`;
                                spriteElement.style.height = `${frameH}px`;

                                // Position the background image to show the specific frame
                                spriteElement.style.backgroundPosition = `-${frame.x}px -${frame.y}px`;
                                spriteElement.style.backgroundSize = 'auto'; // Ensure original size of background image

                                // Get custom dimensions from configuration, or use default
                                const config = spriteConfigurations[asset] && spriteConfigurations[asset][frameName] || {};
                                const targetWidth = config.targetWidth || 182;
                                const targetHeight = config.targetHeight || 280;
                                const left = config.left || '50%';
                                const top = config.top || '20%';

                                // Calculate scale to fit the element
                                const scaleX = targetWidth / sourceSize.w;
                                const scaleY = targetHeight / sourceSize.h;
                                const scale = Math.min(scaleX, scaleY); // Use 'contain' logic

                                console.log(`Calculated scale: ${scale}`);

                                let transform = `translate(-50%, -50%) scale(${scale})`;
                                if (rotated) {
                                    transform += ' rotate(-90deg)';
                                }
                                
                                // Apply the scale and centering using CSS transform
                                spriteElement.style.transform = transform;
                                spriteElement.style.transformOrigin = 'center center'; // Scale from center
                                spriteElement.style.position = 'absolute';
                                spriteElement.style.left = left;
                                spriteElement.style.top = top;

                            } else if (asset === 'menu_1') { // Logic for 'menu_1' asset (images in boxes)
                                console.log("Applying 'menu_1' asset logic.");
                                
                                const frameW = rotated ? frame.h : frame.w;
                                const frameH = rotated ? frame.w : frame.h;

                                // Set the element's dimensions to the frame's dimensions
                                spriteElement.style.width = `${frameW}px`;
                                spriteElement.style.height = `${frameH}px`;

                                // Position the background image to show the specific frame
                                spriteElement.style.backgroundPosition = `-${frame.x}px -${frame.y}px`;
                                spriteElement.style.backgroundSize = 'auto'; // Ensure original size of background image

                                // Get custom dimensions from configuration, or use default
                                const config = spriteConfigurations[asset] && spriteConfigurations[asset][frameName] || {};
                                const targetWidth = config.targetWidth || 150; // Default for menu_1 asset
                                const targetHeight = config.targetHeight || 150; // Default for menu_1 asset
                                const left = config.left || '50%'; // Default centering
                                const top = config.top || '50%'; // Default centering

                                // Calculate scale to fit the element
                                const scaleX = targetWidth / sourceSize.w;
                                const scaleY = targetHeight / sourceSize.h;
                                const scale = Math.min(scaleX, scaleY); // Use 'contain' logic

                                console.log(`Calculated scale: ${scale}`);

                                let transform = `translate(-50%, -50%) scale(${scale})`;
                                if (rotated) {
                                    transform += ' rotate(-90deg)';
                                }
                                
                                // Apply the scale and centering using CSS transform
                                spriteElement.style.transform = transform;
                                spriteElement.style.transformOrigin = 'center center'; // Scale from center
                                spriteElement.style.position = 'absolute';
                                spriteElement.style.left = left;
                                spriteElement.style.top = top;
                                spriteElement.style.overflow = `hidden`; // Keep overflow hidden

                            } else { // Default behavior for other assets (if any)
                                console.log("Applying default asset logic.");
                                // Apply the scale to the entire background image (spritesheet)
                                spriteElement.style.backgroundSize = `${spritesheetWidth}px ${spritesheetHeight}px`;

                                // Calculate the background position for the specific frame
                                const bgPosX = -(frame.x + (trimmed ? spriteSourceSize.x : 0));
                                const bgPosY = -(frame.y + (trimmed ? spriteSourceSize.y : 0));
                                spriteElement.style.backgroundPosition = `${bgPosX}px ${bgPosY}px`;

                                // Reset any inline styles that might interfere
                                spriteElement.style.width = 'auto';
                                spriteElement.style.height = 'auto';
                                spriteElement.style.transform = 'none';
                                spriteElement.style.transformOrigin = 'initial';
                                spriteElement.style.position = 'static';
                                spriteElement.style.left = 'auto';
                                spriteElement.style.top = 'auto';
                            }

                        } else {
                            console.warn(`Frame '${frameName}' not found in ${jsonUrl}`);
                        }
                    })
                    .catch(error => {
                        console.error('Error loading sprite data:', error);
                    });
            }
        });
    </script>
    <script>
        window.addEventListener('resize', function() {
            let scale = Math.min(window.innerWidth / 1200, 1);
            document.body.style.transform = "scale(" + scale + ")";
            document.body.style.transformOrigin = "top left";
        });
        // Initial call to set the scale on load
        window.dispatchEvent(new Event('resize'));
    </script>
    <!-- Zoom Controls -->
    <div class="fixed bottom-4 right-4 z-20 flex flex-col gap-2">
        <button id="zoom-in-btn" class="w-10 h-10 bg-slate-800/50 hover:bg-slate-700 text-white rounded-full flex items-center justify-center transition-colors">
            <i class="fas fa-plus"></i>
        </button>
        <button id="zoom-out-btn" class="w-10 h-10 bg-slate-800/50 hover:bg-slate-700 text-white rounded-full flex items-center justify-center transition-colors">
            <i class="fas fa-minus"></i>
        </button>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const dashboardContainer = document.getElementById('dashboard-container');
            let currentZoom = 1;

            // Function to apply the zoom
            function applyZoom() {
                dashboardContainer.style.transform = `scale(${currentZoom})`;
                dashboardContainer.style.transformOrigin = 'top left';
            }

            // Zoom In
            document.getElementById('zoom-in-btn').addEventListener('click', () => {
                currentZoom += 0.1;
                applyZoom();
            });

            // Zoom Out
            document.getElementById('zoom-out-btn').addEventListener('click', () => {
                if (currentZoom > 0.5) { // Prevent zooming out too much
                    currentZoom -= 0.1;
                    applyZoom();
                }
            });
        });
    </script>
</body>

</html>