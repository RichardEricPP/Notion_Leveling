<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sync Log - Streak Calendar</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Three.js Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <!-- Three.js Addons -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/EffectComposer.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/RenderPass.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/shaders/CopyShader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/ShaderPass.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/shaders/LuminosityHighPassShader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/UnrealBloomPass.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <style>
        /* Custom styles and color palette */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f172a; /* bg-slate-900 */
            overflow: hidden;
            margin: 0;
        }
        .main-container-bg {
            background-color: #1e293b; /* bg-slate-800 */
        }
        .text-accent {
            color: #38bdf8; /* text-sky-400 */
        }

        /* --- Three.js Portal Styles --- */
        #world {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            z-index: 1;
            transition: opacity 1.5s ease-out;
        }

        #welcome-wrapper {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 10;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: opacity 0.5s ease-out;
        }
        
        /* New Welcome Screen Styles */
        .welcome-container {
            background-color: rgba(17, 24, 39, 0.7); /* bg-gray-900 with transparency */
            border: 1px solid #0ea5e9; /* border-sky-500 */
            box-shadow: 0 0 25px rgba(14, 165, 233, 0.3); /* sky-500 glow */
            backdrop-filter: blur(5px); /* Frosted glass effect */
            -webkit-backdrop-filter: blur(5px);
        }
        .welcome-title {
            color: #67e8f9; /* text-cyan-300 */
            text-shadow: 0 0 10px rgba(103, 232, 249, 0.5);
        }
        .sync-button {
            background-color: #ffffff;
            color: #111827; /* text-gray-900 */
        }
        .sync-button:hover {
            background-color: #e5e7eb; /* gray-200 */
        }

        /* Calendar Styles */
        .day-cell { transition: all 0.2s ease-in-out; }
        .day-cell:not(.other-month):not(.future-day):hover { background-color: #334155; cursor: pointer; }
        .day-cell.future-day { cursor: not-allowed; opacity: 0.6; }
        .day-cell.completed .date-number { background-color: #22c55e; color: #ffffff; }
        .day-cell.missed .date-number { background-color: #ef4444; color: #ffffff; }
        .date-number { width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; border-radius: 50%; }
        .today .date-number { background-color: #38bdf8; color: #1e293b; }
        
        /* --- Animation Styles --- */
        .fade-out { opacity: 0 !important; }
        .fade-in { opacity: 1 !important; transition: opacity 0.5s ease-in; }
    </style>
</head>
<body class="text-slate-300">
    
    <!-- Three.js Portal Container -->
    <div id="world"></div>

    <!-- Welcome Screen -->
    <div id="welcome-wrapper">
        <div class="welcome-container w-full max-w-md mx-auto rounded-2xl p-8 text-center">
            <h1 class="welcome-title text-5xl font-bold mb-3">The System</h1>
            <p class="text-slate-200 mb-8 leading-relaxed">
                The System awaits your presence.<br>
                If you do not register today, you are likely to die.<br><br>
                Are you ready for synchronization? âš¡
            </p>
            <button id="sync-button" class="sync-button w-full font-bold py-3 px-8 rounded-lg transition-colors duration-300 flex items-center justify-center gap-3 text-lg">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></svg>
                SYNCHRONIZE
            </button>
        </div>
    </div>

    <!-- Calendar Container (initially hidden and transparent) -->
    <div id="calendar-container" class="main-container-bg rounded-xl shadow-2xl p-4 sm:p-6 w-full max-w-4xl" style="display: none; opacity: 0; position: relative; z-index: 20; margin: auto;">
        <!-- Main Header -->
        <header class="flex justify-between items-center mb-4">
            <h1 class="text-2xl font-bold text-slate-100 flex items-center gap-3">
                <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-accent"><path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z"></path><path d="m10 8 4 4-4 4"></path></svg>
                Sync Log
            </h1>
            <div class="flex items-center gap-4">
                 <div class="text-right">
                    <p class="text-amber-400 text-sm font-medium">ðŸ”¥ <span id="streak-days">0</span> Days</p>
                    <p class="text-slate-400 text-xs">Record: <span id="record-days">0</span></p>
                </div>
                <button id="back-btn" class="text-slate-400 hover:text-white transition p-2 rounded-full hover:bg-slate-700">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>
                </button>
            </div>
        </header>

        <!-- Calendar -->
        <div class="mt-6">
            <div class="flex justify-between items-center mb-4">
                <button id="prev-month" class="p-2 rounded-full hover:bg-slate-700 transition">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"></polyline></svg>
                </button>
                <h2 id="month-year" class="text-xl font-semibold text-accent"></h2>
                <button id="next-month" class="p-2 rounded-full hover:bg-slate-700 transition">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg>
                </button>
            </div>
            <div class="grid grid-cols-7 gap-2 text-center text-sm text-slate-400 mb-2">
                <div>Mon</div><div>Tue</div><div>Wed</div><div>Thu</div><div>Fri</div><div>Sat</div><div>Sun</div>
            </div>
            <div id="calendar-grid" class="grid grid-cols-7 gap-1"></div>
        </div>

        <!-- Legend -->
        <footer class="mt-6 pt-4 border-t border-slate-700 flex flex-wrap items-center justify-center gap-x-6 gap-y-2 text-xs text-slate-400">
            <div class="flex items-center gap-2"><span class="w-3 h-3 rounded-full bg-green-500"></span> Synchronized</div>
            <div class="flex items-center gap-2"><span class="w-3 h-3 rounded-full bg-red-500"></span> Sync Failure</div>
        </footer>
    </div>

    <script>
        // --- THREE.JS SCENE SETUP ---
        var scene, camera, renderer, composer, material, bloomPass;
        var width = window.innerWidth;
        var height = window.innerHeight;

        // Shader Portal Options
        var options = {
            exposure: 2.8,
            bloomStrength: 1.7,
            bloomThreshold: 0,
            bloomRadius: 0.5,
            color0: [10, 15, 30],      // Very Dark Blue
            color1: [20, 40, 90],      // Deep Blue
            color2: [40, 100, 200],    // Main swirling blue
            color3: [103, 232, 249],   // Bright Cyan highlight
            color4: [255, 255, 255],   // White core
            color5: [5, 10, 20],       // Almost black background
        };

        // Shader Code
        const vert = `
            varying vec3 vNormal;
            varying vec3 camPos;
            varying vec2 vUv;
            void main() {
                vNormal = normal;
                vUv = uv;
                camPos = cameraPosition;
                gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
            }
        `;
        const frag = `
            #define NUM_OCTAVES 5
            #define M_PI 3.1415926535897932384626433832795
            uniform vec4 resolution;
            varying vec3 vNormal;
            uniform sampler2D perlinnoise;
            uniform sampler2D sparknoise;
            uniform sampler2D waterturbulence;
            uniform sampler2D noiseTex;
            uniform float time;
            uniform vec3 color0;
            uniform vec3 color1;
            uniform vec3 color2;
            uniform vec3 color3;
            uniform vec3 color4;
            uniform vec3 color5;
            varying vec3 camPos;
            varying vec2 vUv;

            float rand(vec2 n) { return fract(sin(dot(n, vec2(12.9898, 4.1414))) * 43758.5453); }
            float noise(vec2 p){
                vec2 ip = floor(p);
                vec2 u = fract(p);
                u = u*u*(3.0-2.0*u);
                float res = mix(mix(rand(ip),rand(ip+vec2(1.0,0.0)),u.x), mix(rand(ip+vec2(0.0,1.0)),rand(ip+vec2(1.0,1.0)),u.x),u.y);
                return res*res;
            }
            float fbm(vec2 x) {
                float v = 0.0;
                float a = 0.5;
                vec2 shift = vec2(100);
                mat2 rot = mat2(cos(0.5), sin(0.5), -sin(0.5), cos(0.50));
                for (int i = 0; i < NUM_OCTAVES; ++i) {
                    v += a * noise(x);
                    x = rot * x * 2.0 + shift;
                    a *= 0.5;
                }
                return v;
            }
            float setOpacity(float r, float g, float b, float tonethreshold) {
                float tone = (r + g + b) / 3.0;
                float alpha = 1.0;
                if(tone<tonethreshold) { alpha = 0.0; }
                return alpha;
            }
            vec3 rgbcol(vec3 col) { return vec3(col.r/255.0,col.g/255.0,col.b/255.0); }
            vec2 rotate(vec2 v, float a) {
                float s = sin(a);
                float c = cos(a);
                mat2 m = mat2(c, -s, s, c);
                return m * v;
            }
            vec2 UnityPolarCoordinates (vec2 UV, vec2 Center, float RadialScale, float LengthScale){
                vec2 delta = UV - Center;
                float radius = length(delta) * 2. * RadialScale;
                float angle = atan(delta.x, delta.y) * 1.0/6.28 * LengthScale;
                return vec2(radius, angle);
            }
            void main() {
                vec2 olduv = gl_FragCoord.xy/resolution.xy ;
                vec2 uv = vUv;
                float scale = 1.;
                olduv *= 0.5 + time;
                vec2 p = olduv*scale;
                float pct = distance(vUv,vec2(0.5));
                vec3 rgbcolor0 = rgbcol(color0);
                vec3 rgbcolor1 = rgbcol(color1);
                vec3 rgbcolor2 = rgbcol(color2);
                vec3 rgbcolor3 = rgbcol(color3);
                vec3 rgbcolor4 = rgbcol(color4);
                vec3 rgbcolor5 = rgbcol(color5);
                float y = smoothstep(0.16,0.525,pct);
                vec3 backcolor = mix(rgbcolor0, rgbcolor5, y);
                gl_FragColor = vec4(backcolor,1.);
                vec2 center = vec2(0.5);
                vec2 cor = UnityPolarCoordinates(vUv, center, 1., 1.);
                vec2 newvUv = vUv - 0.5;
                vec3 noisetexvUv = texture2D(perlinnoise,mod(rotate(newvUv*0.15 + vec2(sin(time*0.005),cos(time*0.005)),time),1.)).rgb;
                vec2 newUv = vec2(cor.x + time,cor.x+cor.y);
                vec3 noisetex = texture2D(perlinnoise,mod(newUv,1.)).rgb;
                vec3 noisetex2 = texture2D(sparknoise,mod(newUv,1.)).rgb;
                vec3 noisetex3 = texture2D(waterturbulence,mod(newUv,1.)).rgb;
                float tone0 = 1. - smoothstep(0.3,0.6,noisetex.r);
                float tone1 = smoothstep(0.3,0.6,noisetex2.r);
                float tone2 = smoothstep(0.3,0.6,noisetex3.r);
                float opacity0 = setOpacity(tone0,tone0,tone0,.29);
                float opacity1 = setOpacity(tone1,tone1,tone1,.49);
                float opacity2 = setOpacity(tone2,tone2,tone2,.69);
                float gradienttone = 1. - smoothstep(0.196,0.532,pct);
                vec4 circularnoise = vec4( vec3(gradienttone)*noisetexvUv*1.4, 1.0 );
                float gradopacity = setOpacity(circularnoise.r,circularnoise.g,circularnoise.b,0.19);
                vec2 uv2 = uv;
                float iTime = time*0.004;
                uv.y += iTime / 10.0;
                uv.x -= (sin(iTime/10.0)/2.0);
                uv2.x += iTime / 14.0;
                uv2.x += (sin(iTime/10.0)/9.0);
                float result = 0.0;
                result += texture2D(noiseTex, mod(uv*0.5,1.) * 0.6 + vec2(iTime*-0.003)).r;
                result *= texture2D(noiseTex, mod(uv2*0.5,1.) * 0.9 + vec2(iTime*+0.002)).b;
                result = pow(result, 4.0);
                if(opacity2>0.0){ gl_FragColor = vec4(rgbcolor4,0.)*vec4(opacity2); }
                else if(opacity1>0.0){ gl_FragColor = vec4(rgbcolor2,0.)*vec4(opacity1); }
                else if(opacity0>0.0){ gl_FragColor = vec4(rgbcolor1,0.)*vec4(opacity0); }
                gl_FragColor += vec4(108.0)*result*(y*0.02);
                gl_FragColor *= vec4(gradopacity);
            }
        `;

        const initThree = () => {
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(75, width / height, 0.1, 10000);
            camera.position.z = 5;
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.setSize(width, height);
            renderer.autoClear = false;
            document.getElementById("world").appendChild(renderer.domElement);
            material = new THREE.ShaderMaterial({
                uniforms: {
                    time: { value: 0.0 },
                    perlinnoise: { value: new THREE.TextureLoader().load('https://raw.githubusercontent.com/pizza3/asset/master/noise9.png') },
                    sparknoise: { value: new THREE.TextureLoader().load('https://raw.githubusercontent.com/pizza3/asset/master/sparklenoise.png') },
                    waterturbulence: { value: new THREE.TextureLoader().load('https://raw.githubusercontent.com/pizza3/asset/master/waterturbulence.png') },
                    noiseTex: { value: new THREE.TextureLoader().load('https://raw.githubusercontent.com/pizza3/asset/master/rgbnoise2.png') },
                    color5: { value: new THREE.Vector3(...options.color5) },
                    color4: { value: new THREE.Vector3(...options.color4) },
                    color3: { value: new THREE.Vector3(...options.color3) },
                    color2: { value: new THREE.Vector3(...options.color2) },
                    color1: { value: new THREE.Vector3(...options.color1) },
                    color0: { value: new THREE.Vector3(...options.color0) },
                    resolution: { value: new THREE.Vector2(width, height) },
                },
                fragmentShader: frag,
                vertexShader: vert,
            });
            var planegeometry = new THREE.PlaneGeometry(10, 10, 1, 1);
            var plane = new THREE.Mesh(planegeometry, material);
            scene.add(plane);
            var renderScene = new THREE.RenderPass(scene, camera);
            bloomPass = new THREE.UnrealBloomPass(new THREE.Vector2(width, height), 1.5, 0.4, 0.85);
            bloomPass.threshold = options.bloomThreshold;
            bloomPass.strength = options.bloomStrength;
            bloomPass.radius = options.bloomRadius;
            composer = new THREE.EffectComposer(renderer);
            composer.addPass(renderScene);
            composer.addPass(bloomPass);
        };

        const animateThree = (deltaTime) => {
            requestAnimationFrame(animateThree);
            material.uniforms.time.value = deltaTime / 18000;
            material.uniforms.color0.value = new THREE.Vector3(...options.color0);
            material.uniforms.color1.value = new THREE.Vector3(...options.color1);
            material.uniforms.color2.value = new THREE.Vector3(...options.color2);
            material.uniforms.color3.value = new THREE.Vector3(...options.color3);
            material.uniforms.color4.value = new THREE.Vector3(...options.color4);
            material.uniforms.color5.value = new THREE.Vector3(...options.color5);
            bloomPass.strength = options.bloomStrength;
            bloomPass.radius = options.bloomRadius;
            composer.render();
        };

        const handleResize = () => {
            width = window.innerWidth;
            height = window.innerHeight;
            camera.aspect = width / height;
            camera.updateProjectionMatrix();
            renderer.setSize(width, height);
            composer.setSize(width, height);
        };

        window.addEventListener("resize", handleResize, false);
        
        // --- WebGL Support Check ---
        function isWebGLAvailable() {
            try {
                const canvas = document.createElement('canvas');
                return !!(window.WebGLRenderingContext && (canvas.getContext('webgl') || canvas.getContext('experimental-webgl')));
            } catch (e) {
                return false;
            }
        }

        // --- CALENDAR APP LOGIC ---
        document.addEventListener('DOMContentLoaded', function () {
            if (isWebGLAvailable()) {
                try {
                    initThree();
                    animateThree();
                } catch (e) {
                    console.error("Three.js initialization failed:", e);
                    const worldEl = document.getElementById('world');
                    if(worldEl) worldEl.style.display = 'none';
                }
            } else {
                console.warn("WebGL is not supported. 3D background is disabled.");
                const worldEl = document.getElementById('world');
                if(worldEl) worldEl.style.display = 'none';
            }
            
            // --- DOM ELEMENTS ---
            const welcomeWrapperEl = document.getElementById('welcome-wrapper');
            const worldEl = document.getElementById('world');
            const calendarContainerEl = document.getElementById('calendar-container');
            const syncButtonEl = document.getElementById('sync-button');
            const monthYearEl = document.getElementById('month-year');
            const calendarGridEl = document.getElementById('calendar-grid');
            const prevMonthBtn = document.getElementById('prev-month');
            const nextMonthBtn = document.getElementById('next-month');
            const streakDaysEl = document.getElementById('streak-days');
            const recordDaysEl = document.getElementById('record-days');
            const backBtn = document.getElementById('back-btn');

            // --- STATE ---
            let currentDate = new Date(); 
            const dayStates = JSON.parse(localStorage.getItem('questLogDayStates')) || {};
            const today = new Date();
            today.setHours(0, 0, 0, 0);

            // --- LOGIC ---
            const monthNames = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];

            function renderCalendar() {
                const year = currentDate.getFullYear();
                const month = currentDate.getMonth();
                monthYearEl.textContent = `${monthNames[month]} ${year}`;
                calendarGridEl.innerHTML = '';
                const firstDayOfMonth = new Date(year, month, 1).getDay();
                const adjustedFirstDay = (firstDayOfMonth === 0) ? 6 : firstDayOfMonth - 1;
                const daysInMonth = new Date(year, month + 1, 0).getDate();
                const daysInPrevMonth = new Date(year, month, 0).getDate();
                for (let i = adjustedFirstDay; i > 0; i--) {
                    calendarGridEl.appendChild(createDayCell(daysInPrevMonth - i + 1, month - 1, year, true));
                }
                for (let i = 1; i <= daysInMonth; i++) {
                    calendarGridEl.appendChild(createDayCell(i, month, year, false));
                }
                const remainingCells = 42 - (adjustedFirstDay + daysInMonth);
                for (let i = 1; i <= remainingCells; i++) {
                     calendarGridEl.appendChild(createDayCell(i, month + 1, year, true));
                }
                updateStreak();
            }

            function createDayCell(day, month, year, isOtherMonth) {
                const cell = document.createElement('div');
                const dateNumber = document.createElement('div');
                dateNumber.textContent = day;
                dateNumber.classList.add('date-number');
                cell.classList.add('day-cell', 'h-14', 'flex', 'items-center', 'justify-center', 'rounded-lg');
                cell.appendChild(dateNumber);
                const cellDate = new Date(year, month, day);
                cellDate.setHours(0,0,0,0);
                const dateKey = `${cellDate.getFullYear()}-${cellDate.getMonth()}-${cellDate.getDate()}`;
                if (isOtherMonth) {
                    cell.classList.add('other-month', 'text-slate-600');
                } else {
                    if (cellDate.getTime() === today.getTime()) cell.classList.add('today');
                    if (cellDate > today) cell.classList.add('future-day');
                    const state = dayStates[dateKey];
                    if (state) cell.classList.add(state);
                    cell.addEventListener('click', () => handleDayClick(cell, dateKey, cellDate));
                }
                return cell;
            }
            
            function handleDayClick(cell, dateKey, clickedDate) {
                if (clickedDate > today) return;
                const currentState = dayStates[dateKey];
                let nextState = 'completed';
                cell.classList.remove('completed', 'missed');
                if (currentState === 'completed') {
                    nextState = 'missed';
                } else if (currentState === 'missed') {
                    delete dayStates[dateKey];
                    nextState = null;
                }
                if (nextState) {
                    dayStates[dateKey] = nextState;
                    cell.classList.add(nextState);
                }
                localStorage.setItem('questLogDayStates', JSON.stringify(dayStates));
                updateStreak();
            }
            
            function updateStreak() {
                let currentStreak = 0, recordStreak = 0, tempStreak = 0;
                const sortedDates = Object.keys(dayStates)
                    .filter(key => dayStates[key] === 'completed')
                    .map(key => {
                        const parts = key.split('-').map(Number);
                        return new Date(parts[0], parts[1], parts[2]);
                    })
                    .sort((a, b) => a - b);
                if (sortedDates.length > 0) {
                    tempStreak = 1; recordStreak = 1;
                    for (let i = 1; i < sortedDates.length; i++) {
                        const diff = (sortedDates[i] - sortedDates[i-1]) / (1000 * 60 * 60 * 24);
                        if (diff === 1) tempStreak++; else tempStreak = 1;
                        if (tempStreak > recordStreak) recordStreak = tempStreak;
                    }
                    const lastCompletedDate = sortedDates[sortedDates.length - 1];
                    const diffFromToday = (today - lastCompletedDate) / (1000 * 60 * 60 * 24);
                    if (diffFromToday <= 1) currentStreak = tempStreak; else currentStreak = 0;
                }
                streakDaysEl.textContent = currentStreak;
                recordDaysEl.textContent = recordStreak;

                // Save to localStorage for the main menu
                localStorage.setItem('playerStreak', currentStreak);
                localStorage.setItem('playerRecordStreak', recordStreak);
            }

            // --- EVENT LISTENERS ---
            syncButtonEl.addEventListener('click', () => {
                welcomeWrapperEl.classList.add('fade-out');
                worldEl.classList.add('fade-out');

                setTimeout(() => {
                    welcomeWrapperEl.style.display = 'none';
                    worldEl.style.display = 'none';
                    
                    const calendarPage = document.createElement('div');
                    calendarPage.className = 'absolute top-0 left-0 w-full h-full flex items-center justify-center p-4';
                    calendarPage.appendChild(calendarContainerEl);
                    document.body.appendChild(calendarPage);

                    calendarContainerEl.style.display = 'block';
                    
                    const todayKey = `${today.getFullYear()}-${today.getMonth()}-${today.getDate()}`;
                    dayStates[todayKey] = 'completed';
                    localStorage.setItem('questLogDayStates', JSON.stringify(dayStates));
                    currentDate = new Date();
                    renderCalendar();
                    requestAnimationFrame(() => {
                        calendarContainerEl.classList.add('fade-in');
                    });
                }, 1500);
            });

            prevMonthBtn.addEventListener('click', () => {
                currentDate.setMonth(currentDate.getMonth() - 1);
                renderCalendar();
            });

            nextMonthBtn.addEventListener('click', () => {
                currentDate.setMonth(currentDate.getMonth() + 1);
                renderCalendar();
            });

            backBtn.addEventListener('click', () => {
                history.back();
            });
        });
    </script>
</body>
</html>