<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sync Log - Streak Calendar</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f172a; /* bg-slate-900 */
            color: #e2e8f0;
        }
        .main-container-bg {
            background-color: #1e293b; /* bg-slate-800 */
        }
        .text-accent {
            color: #38bdf8; /* text-sky-400 */
        }
        .day-cell { transition: all 0.2s ease-in-out; }
        .day-cell:not(.other-month):not(.future-day):hover { background-color: #334155; cursor: pointer; }
        .day-cell.future-day { cursor: not-allowed; opacity: 0.6; }
        .day-cell.completed .date-number { background-color: #22c55e; color: #ffffff; }
        .day-cell.missed .date-number { background-color: #ef4444; color: #ffffff; }
        .date-number { width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; border-radius: 50%; }
        .today .date-number { background-color: #38bdf8; color: #1e293b; }
    </style>
</head>
<body class="p-4 lg:p-6 flex items-center justify-center min-h-screen">

    <!-- Calendar Container -->
    <div id="calendar-container" class="main-container-bg rounded-xl shadow-2xl p-4 sm:p-6 w-full max-w-4xl">
        <!-- Main Header -->
        <header class="flex justify-between items-center mb-4">
            <h1 class="text-2xl font-bold text-slate-100 flex items-center gap-3">
                <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-accent"><path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z"></path><path d="m10 8 4 4-4 4"></path></svg>
                Sync Log
            </h1>
            <div class="flex items-center gap-4">
                 <div class="text-right">
                    <p class="text-amber-400 text-sm font-medium">ðŸ”¥ <span id="streak-days">0</span> Days</p>
                    <p class="text-slate-400 text-xs">Record: <span id="record-days">0</span></p>
                </div>
                <button id="back-btn" class="text-slate-400 hover:text-white transition p-2 rounded-full hover:bg-slate-700">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>
                </button>
            </div>
        </header>

        <!-- Calendar -->
        <div class="mt-6">
            <div class="flex justify-between items-center mb-4">
                <button id="prev-month" class="p-2 rounded-full hover:bg-slate-700 transition">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"></polyline></svg>
                </button>
                <h2 id="month-year" class="text-xl font-semibold text-accent"></h2>
                <button id="next-month" class="p-2 rounded-full hover:bg-slate-700 transition">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg>
                </button>
            </div>
            <div class="grid grid-cols-7 gap-2 text-center text-sm text-slate-400 mb-2">
                <div>Mon</div><div>Tue</div><div>Wed</div><div>Thu</div><div>Fri</div><div>Sat</div><div>Sun</div>
            </div>
            <div id="calendar-grid" class="grid grid-cols-7 gap-1"></div>
        </div>

        <!-- Legend -->
        <footer class="mt-6 pt-4 border-t border-slate-700 flex flex-wrap items-center justify-center gap-x-6 gap-y-2 text-xs text-slate-400">
            <div class="flex items-center gap-2"><span class="w-3 h-3 rounded-full bg-green-500"></span> Synchronized</div>
            <div class="flex items-center gap-2"><span class="w-3 h-3 rounded-full bg-red-500"></span> Sync Failure</div>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const monthYearEl = document.getElementById('month-year');
            const calendarGridEl = document.getElementById('calendar-grid');
            const prevMonthBtn = document.getElementById('prev-month');
            const nextMonthBtn = document.getElementById('next-month');
            const streakDaysEl = document.getElementById('streak-days');
            const recordDaysEl = document.getElementById('record-days');
            const backBtn = document.getElementById('back-btn');

            let currentDate = new Date(); 
            const dayStates = JSON.parse(localStorage.getItem('questLogDayStates')) || {};
            const today = new Date();
            today.setHours(0, 0, 0, 0);

            const monthNames = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];

            function renderCalendar() {
                const year = currentDate.getFullYear();
                const month = currentDate.getMonth();
                monthYearEl.textContent = `${monthNames[month]} ${year}`;
                calendarGridEl.innerHTML = '';
                const firstDayOfMonth = new Date(year, month, 1).getDay();
                const adjustedFirstDay = (firstDayOfMonth === 0) ? 6 : firstDayOfMonth - 1;
                const daysInMonth = new Date(year, month + 1, 0).getDate();
                const daysInPrevMonth = new Date(year, month, 0).getDate();
                for (let i = adjustedFirstDay; i > 0; i--) {
                    calendarGridEl.appendChild(createDayCell(daysInPrevMonth - i + 1, month - 1, year, true));
                }
                for (let i = 1; i <= daysInMonth; i++) {
                    calendarGridEl.appendChild(createDayCell(i, month, year, false));
                }
                const remainingCells = 42 - (adjustedFirstDay + daysInMonth);
                for (let i = 1; i <= remainingCells; i++) {
                     calendarGridEl.appendChild(createDayCell(i, month + 1, year, true));
                }
                updateStreak();
            }

            function createDayCell(day, month, year, isOtherMonth) {
                const cell = document.createElement('div');
                const dateNumber = document.createElement('div');
                dateNumber.textContent = day;
                dateNumber.classList.add('date-number');
                cell.classList.add('day-cell', 'h-14', 'flex', 'items-center', 'justify-center', 'rounded-lg');
                cell.appendChild(dateNumber);
                const cellDate = new Date(year, month, day);
                cellDate.setHours(0,0,0,0);
                const dateKey = `${cellDate.getFullYear()}-${cellDate.getMonth()}-${cellDate.getDate()}`;
                if (isOtherMonth) {
                    cell.classList.add('other-month', 'text-slate-600');
                } else {
                    if (cellDate.getTime() === today.getTime()) cell.classList.add('today');
                    if (cellDate > today) cell.classList.add('future-day');
                    const state = dayStates[dateKey];
                    if (state) cell.classList.add(state);
                    cell.addEventListener('click', () => handleDayClick(cell, dateKey, cellDate));
                }
                return cell;
            }
            
            function handleDayClick(cell, dateKey, clickedDate) {
                if (clickedDate > today) return;
                const currentState = dayStates[dateKey];
                let nextState = 'completed';
                cell.classList.remove('completed', 'missed');
                if (currentState === 'completed') {
                    nextState = 'missed';
                } else if (currentState === 'missed') {
                    delete dayStates[dateKey];
                    nextState = null;
                }
                if (nextState) {
                    dayStates[dateKey] = nextState;
                    cell.classList.add(nextState);
                }
                localStorage.setItem('questLogDayStates', JSON.stringify(dayStates));
                updateStreak();
            }
            
            function updateStreak() {
                let currentStreak = 0, recordStreak = 0, tempStreak = 0;
                const sortedDates = Object.keys(dayStates)
                    .filter(key => dayStates[key] === 'completed')
                    .map(key => {
                        const parts = key.split('-').map(Number);
                        return new Date(parts[0], parts[1], parts[2]);
                    })
                    .sort((a, b) => a - b);
                if (sortedDates.length > 0) {
                    tempStreak = 1; recordStreak = 1;
                    for (let i = 1; i < sortedDates.length; i++) {
                        const diff = (sortedDates[i] - sortedDates[i-1]) / (1000 * 60 * 60 * 24);
                        if (diff === 1) tempStreak++; else tempStreak = 1;
                        if (tempStreak > recordStreak) recordStreak = tempStreak;
                    }
                    const lastCompletedDate = sortedDates[sortedDates.length - 1];
                    const diffFromToday = (today - lastCompletedDate) / (1000 * 60 * 60 * 24);
                    if (diffFromToday <= 1) currentStreak = tempStreak; else currentStreak = 0;
                }
                streakDaysEl.textContent = currentStreak;
                recordDaysEl.textContent = recordStreak;
                localStorage.setItem('playerStreak', currentStreak);
                localStorage.setItem('playerRecordStreak', recordStreak);
            }

            prevMonthBtn.addEventListener('click', () => {
                currentDate.setMonth(currentDate.getMonth() - 1);
                renderCalendar();
            });

            nextMonthBtn.addEventListener('click', () => {
                currentDate.setMonth(currentDate.getMonth() + 1);
                renderCalendar();
            });

            backBtn.addEventListener('click', () => {
                history.back();
            });

            renderCalendar();
        });
    </script>
</body>
</html>