<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sync Log - Streak Calendar</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Custom styles and color palette */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f172a; /* bg-slate-900 */
        }
        .main-container-bg {
            background-color: #1e293b; /* bg-slate-800 */
        }
        .text-accent {
            color: #38bdf8; /* text-sky-400 */
        }
        
        /* New Welcome Screen Styles */
        .welcome-container {
            background-color: #111827; /* bg-gray-900, slightly different from calendar */
            border: 1px solid #0ea5e9; /* border-sky-500 */
            box-shadow: 0 0 25px rgba(14, 165, 233, 0.3); /* sky-500 glow */
        }
        .welcome-title {
            color: #67e8f9; /* text-cyan-300 */
            text-shadow: 0 0 10px rgba(103, 232, 249, 0.5);
        }
        .sync-button {
            background-color: #ffffff;
            color: #111827; /* text-gray-900 */
        }
        .sync-button:hover {
            background-color: #e5e7eb; /* gray-200 */
        }


        /* Calendar Styles */
        .day-cell {
            transition: all 0.2s ease-in-out;
        }
        .day-cell:not(.other-month):not(.future-day):hover {
            background-color: #334155; /* bg-slate-700 */
            cursor: pointer;
        }
        .day-cell.future-day {
            cursor: not-allowed;
            opacity: 0.6;
        }
        .day-cell.completed .date-number {
            background-color: #22c55e; /* bg-green-500 */
            color: #ffffff;
        }
        .day-cell.missed .date-number {
            background-color: #ef4444; /* bg-red-500 */
            color: #ffffff;
        }
        .date-number {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }
        .today .date-number {
            background-color: #38bdf8;
            color: #1e293b;
        }
        
        /* --- Animation Styles --- */
        .fade-out {
            opacity: 0;
            transition: opacity 0.5s ease-out;
        }
        .fade-in {
            opacity: 1 !important;
            transition: opacity 0.5s ease-in;
        }
    </style>
</head>
<body class="text-slate-300 flex items-center justify-center min-h-screen p-4">

    <!-- Welcome Screen -->
    <div id="welcome-screen" class="transition-opacity duration-500 w-full">
        <div class="welcome-container max-w-md mx-auto rounded-2xl p-8 text-center">
            <h1 class="welcome-title text-5xl font-bold mb-3">The System</h1>
            <p class="text-slate-400 mb-8 leading-relaxed">
                The System awaits your presence.<br>
                If you do not register today, you are likely to die.<br><br>
                Are you ready for synchronization? âš¡
            </p>
            <button id="sync-button" class="sync-button w-full font-bold py-3 px-8 rounded-lg transition-colors duration-300 flex items-center justify-center gap-3 text-lg">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></svg>
                SYNCHRONIZE
            </button>
        </div>
    </div>

    <!-- Calendar Container (initially hidden and transparent) -->
    <div id="calendar-container" class="main-container-bg rounded-xl shadow-2xl p-4 sm:p-6 w-full max-w-4xl" style="display: none; opacity: 0;">
        <!-- Main Header -->
        <header class="flex justify-between items-center mb-4">
            <h1 class="text-2xl font-bold text-slate-100 flex items-center gap-3">
                <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-accent"><path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z"></path><path d="m10 8 4 4-4 4"></path></svg>
                Sync Log
            </h1>
            <div class="flex items-center gap-4">
                 <div class="text-right">
                    <p class="text-amber-400 text-sm font-medium">ðŸ”¥ <span id="streak-days">0</span> Days</p>
                    <p class="text-slate-400 text-xs">Record: <span id="record-days">0</span></p>
                </div>
                <button class="text-slate-400 hover:text-white transition">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 0 2l-.15.08a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l-.22-.38a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1 0-2l.15-.08a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"></path><circle cx="12" cy="12" r="3"></circle></svg>
                </button>
            </div>
        </header>

        <!-- Calendar -->
        <div class="mt-6">
            <div class="flex justify-between items-center mb-4">
                <button id="prev-month" class="p-2 rounded-full hover:bg-slate-700 transition">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"></polyline></svg>
                </button>
                <h2 id="month-year" class="text-xl font-semibold text-accent"></h2>
                <button id="next-month" class="p-2 rounded-full hover:bg-slate-700 transition">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg>
                </button>
            </div>
            <div class="grid grid-cols-7 gap-2 text-center text-sm text-slate-400 mb-2">
                <div>Mon</div><div>Tue</div><div>Wed</div><div>Thu</div><div>Fri</div><div>Sat</div><div>Sun</div>
            </div>
            <div id="calendar-grid" class="grid grid-cols-7 gap-1"></div>
        </div>

        <!-- Legend -->
        <footer class="mt-6 pt-4 border-t border-slate-700 flex flex-wrap items-center justify-center gap-x-6 gap-y-2 text-xs text-slate-400">
            <div class="flex items-center gap-2"><span class="w-3 h-3 rounded-full bg-green-500"></span> Synchronized</div>
            <div class="flex items-center gap-2"><span class="w-3 h-3 rounded-full bg-red-500"></span> Sync Failure</div>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // --- DOM ELEMENTS ---
            const welcomeScreenEl = document.getElementById('welcome-screen');
            const calendarContainerEl = document.getElementById('calendar-container');
            const syncButtonEl = document.getElementById('sync-button');
            const monthYearEl = document.getElementById('month-year');
            const calendarGridEl = document.getElementById('calendar-grid');
            const prevMonthBtn = document.getElementById('prev-month');
            const nextMonthBtn = document.getElementById('next-month');
            const streakDaysEl = document.getElementById('streak-days');
            const recordDaysEl = document.getElementById('record-days');

            // --- STATE ---
            let currentDate = new Date(); 
            const dayStates = JSON.parse(localStorage.getItem('questLogDayStates')) || {};
            const today = new Date();
            today.setHours(0, 0, 0, 0);

            // --- LOGIC ---
            const monthNames = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];

            function renderCalendar() {
                const year = currentDate.getFullYear();
                const month = currentDate.getMonth();
                monthYearEl.textContent = `${monthNames[month]} ${year}`;
                calendarGridEl.innerHTML = '';
                const firstDayOfMonth = new Date(year, month, 1).getDay();
                const adjustedFirstDay = (firstDayOfMonth === 0) ? 6 : firstDayOfMonth - 1;
                const daysInMonth = new Date(year, month + 1, 0).getDate();
                const daysInPrevMonth = new Date(year, month, 0).getDate();
                for (let i = adjustedFirstDay; i > 0; i--) {
                    calendarGridEl.appendChild(createDayCell(daysInPrevMonth - i + 1, month - 1, year, true));
                }
                for (let i = 1; i <= daysInMonth; i++) {
                    calendarGridEl.appendChild(createDayCell(i, month, year, false));
                }
                const remainingCells = 42 - (adjustedFirstDay + daysInMonth);
                for (let i = 1; i <= remainingCells; i++) {
                     calendarGridEl.appendChild(createDayCell(i, month + 1, year, true));
                }
                updateStreak();
            }

            function createDayCell(day, month, year, isOtherMonth) {
                const cell = document.createElement('div');
                const dateNumber = document.createElement('div');
                dateNumber.textContent = day;
                dateNumber.classList.add('date-number');
                cell.classList.add('day-cell', 'h-14', 'flex', 'items-center', 'justify-center', 'rounded-lg');
                cell.appendChild(dateNumber);
                const cellDate = new Date(year, month, day);
                cellDate.setHours(0,0,0,0);
                const dateKey = `${cellDate.getFullYear()}-${cellDate.getMonth()}-${cellDate.getDate()}`;
                if (isOtherMonth) {
                    cell.classList.add('other-month', 'text-slate-600');
                } else {
                    if (cellDate.getTime() === today.getTime()) cell.classList.add('today');
                    if (cellDate > today) cell.classList.add('future-day');
                    const state = dayStates[dateKey];
                    if (state) cell.classList.add(state);
                    cell.addEventListener('click', () => handleDayClick(cell, dateKey, cellDate));
                }
                return cell;
            }
            
            function handleDayClick(cell, dateKey, clickedDate) {
                if (clickedDate > today) return;
                const currentState = dayStates[dateKey];
                let nextState = 'completed';
                cell.classList.remove('completed', 'missed');
                if (currentState === 'completed') {
                    nextState = 'missed';
                } else if (currentState === 'missed') {
                    delete dayStates[dateKey];
                    nextState = null;
                }
                if (nextState) {
                    dayStates[dateKey] = nextState;
                    cell.classList.add(nextState);
                }
                localStorage.setItem('questLogDayStates', JSON.stringify(dayStates));
                updateStreak();
            }
            
            function updateStreak() {
                let currentStreak = 0, recordStreak = 0, tempStreak = 0;
                const sortedDates = Object.keys(dayStates)
                    .filter(key => dayStates[key] === 'completed')
                    .map(key => {
                        const parts = key.split('-').map(Number);
                        return new Date(parts[0], parts[1], parts[2]);
                    })
                    .sort((a, b) => a - b);
                if (sortedDates.length > 0) {
                    tempStreak = 1; recordStreak = 1;
                    for (let i = 1; i < sortedDates.length; i++) {
                        const diff = (sortedDates[i] - sortedDates[i-1]) / (1000 * 60 * 60 * 24);
                        if (diff === 1) tempStreak++; else tempStreak = 1;
                        if (tempStreak > recordStreak) recordStreak = tempStreak;
                    }
                    const lastCompletedDate = sortedDates[sortedDates.length - 1];
                    const diffFromToday = (today - lastCompletedDate) / (1000 * 60 * 60 * 24);
                    if (diffFromToday <= 1) currentStreak = tempStreak; else currentStreak = 0;
                }
                streakDaysEl.textContent = currentStreak;
                recordDaysEl.textContent = recordStreak;
            }

            // --- EVENT LISTENERS ---
            syncButtonEl.addEventListener('click', () => {
                welcomeScreenEl.classList.add('fade-out');
                setTimeout(() => {
                    welcomeScreenEl.style.display = 'none';
                    calendarContainerEl.style.display = 'block';
                    const todayKey = `${today.getFullYear()}-${today.getMonth()}-${today.getDate()}`;
                    dayStates[todayKey] = 'completed';
                    localStorage.setItem('questLogDayStates', JSON.stringify(dayStates));
                    currentDate = new Date();
                    renderCalendar();
                    requestAnimationFrame(() => {
                        calendarContainerEl.classList.add('fade-in');
                    });
                }, 500);
            });

            prevMonthBtn.addEventListener('click', () => {
                currentDate.setMonth(currentDate.getMonth() - 1);
                renderCalendar();
            });

            nextMonthBtn.addEventListener('click', () => {
                currentDate.setMonth(currentDate.getMonth() + 1);
                renderCalendar();
            });
        });
    </script>
</body>
</html>